Lazy Voice Finderの変更履歴
===========================

Version 1.3.7 (2020/12/27)

機能追加:
- 新しい列 RelativePath の追加 : 音声ファイルのDataフォルダからの相対パス

バグ修正:
- MO2からLVFを起動すると一部のメニューでIOException例外が発生する問題の修正。MO2のMoveFile()エミュレーションの動作はWindows APIと少し異なるため、回避コードを追加した（詳細な報告してくれた@OregonPeteに感謝！）
- プラグインのリロード時にArgumentOutOfRangeException例外が発生する問題の修正。
- Search by Clipboardオプションが有効のとき、オプションダイアログでのコピー操作に反応して検索が実行されてしまう問題の修正。
- (裏で変更された)最新の音声ファイルが再生されない問題の修正。オリジナルのファイルが更新されたらキャッシュを無効にして再度音声ファイルを読み込むようにした。
- 列フィルターの部分フィルタにおいて、選択した項目以外のデータがヒットする問題の修正。項目名を完全一致検索するようにした。
備考:
-  Fallout 76のサポートは依然実験的であり、正しく動作しない可能性が高い。


Version 1.3.6.1(Experimental) (2018/11/4)

機能追加:
- Fallout 76のサポート (実験的)
-- 注意: FO76を持っていないので(購入資金がない)、実装はすべてインターネット上の情報からの推測に基づいています。
-- FO4とesm/fuz/ba2の構造に変わりがないという前提に基づいて実装されています。
-- FO76のインストールパスは自動検出されませんので、ゲームの設定ダイアログでパスを指定してください。
-- プラグインのフォームバージョンが分からないため、FO76のプラグインは"未知のゲーム"として扱われます（動作に影響はないはずです)
-- うまく動いたかどうか報告してください。また、SeventySix.esmのプラグインバージョン/フォームフォームを知っている人がいれば私に教えてください(プラグインの選択ダイアログで確認できます)。


Version 1.3.6 (2018/9/30)

機能追加:
- 64ビットサポート: LazyVoiceFinder.exeは64ビット、LazyVoiceFinder32.exeは32ビットです。
- ツールボタンの追加: 再生音量、再生

変更:
- 条件列の改善: 180以上の関数、判定条件、フォームIDが表示可能に。今のところ、Skyrim以外のゲームでは一部の関数が正しく表示されません。
- フィルターメニューの改善: メニュー幅スライダー、インクリメンタルサーチ、ALTキーで閉じないように(IMEを使うアジア系言語で便利)
- プラグインを開くダイアログの改善: インクリメンタルサーチ
- プラグイン言語の追加: Chinese(BIG5), Chinese(GBK), Hebrew, Japanese(SJIS), Korean(UHC), Thai, Vietnamese 
- カスタム言語: プラグイン言語メニューの"(Custom)"から言語とコードページを自由に選べるようにした
- 関連DLLを最新に。これにともないVC++ 2017ランタイムが必要になった

バグ修正:
- 誤字の修正、その他UIのバグ修正多数
- ユーザー作成eslの音声ファイルが正しく読み込めないバグを修正した。

制限事項(今後のアップデートで修正予定):
- Skyrim/Skyrim SE以外で条件列の関数の一部が正しく表示されません。これは同じ関数IDがゲームによって別の関数に割り当てられているためです。これから他のゲームの関数IDを調べるつもりです。
- ロシア語UIの一部が英語のままです。これからAnizordaに翻訳を依頼します。


Version 1.3.5 (2018/3/25)
機能追加：
- 日本語向け: Migemoによる検索。ローマ字や英単語で日本語の対話を検索できる。別途Migemo辞書のインストールが必要。TES/Fallout用語の追加辞書を同梱。

変更:
- ロシア語訳の改善。anizordaさんに感謝！
- ロードされたプラグインをステータスバーに表示するようにした。ステータスバーのテキストのツールチップで選択されたプラグイン名が、アイコンのツールチップでロードオーダーが確認できる。
- SPACEキーで音声再生できるようにした。
- 検索後にソート列・ソート順がリセットされないようにした。スプレッドシートの左上の右クリックメニューでソート順がリセットできる。
- ステータスバーに選択されたセルの行数を表示する。
- 列の追加: StringId
- Conditions列に表示する条件の追加: LocationHasKeyword (LE/SE/FO4), GetIsVoiceType (LE/SE/FO4), GetInWorldspace, GetInCell, IsPleasant, IsFleeing, IsActor, IsEssential, IsChild, IsProtected, IsUnique, GetIsInjured,IsAttacking, IsPowerAttacking, IsStaggered, IsRecoiling, IsPathing, IsInFavorState
- 再生した音声はキャッシュされる。2回目以降は音声再生のディレイがなくなる。
- オプションダイアログに対話言語の入れ替えボタンを追加した。

バグ修正:
- Fallout4の最新アップデートでクラッシュするかもしれない問題の修正。CCコンテンツファイルの読み込みに失敗していましたが、今は問題ありません。
- 中断せずにサウンドを再生すると、次のトリガーでサウンド再生されないバグの修正。
- データロード時の画面の乱れを軽減。
- ゲームが全くインストールされていないときにツールがクラッシュするバグの修正。
- 条件読み込み処理の再コーディング。これで条件列の表示が大幅に改善されたはず。
- プラグインのロードオーダーの再コーディング。バニラのプラグインがロードオーダーの下に配置されるバグが修正された。
- メッセージのローカライズ漏れを修正した: オプションダイアログの言語のツールチップ
- その他多くの細かな修正と向上


Version 1.3.4 (2018/1/6)
機能追加：
- Fallout4/Skyrim SEのライトマスターファイル(.esl)のサポート。音声ファイルを持つクリエイションクラブのコンテンツを持っていないので、音声ファイルのアセットパスが正確に分かりません。ですので、クリエイションクラブのコンテンツ "ccxxxsse001-foobar.esl" が "sound/voice/ccxxxsse001/..." と "sound/voice/ccxxxsse001-foobar/..." のどちらかを持ち得ると仮定しました。何か問題があれば報告願います。

変更:
- 列名 "AO_Comment" を "Keyword" に変更。
- スプレッドシート列の表示改善。列名の左にソート矢印を表示、ツールチップの追加。
- 列ヘッダの右クリックメニューで列名一覧を名前順にソートするようにした。
- デフォルトのソート順序をIndex:FormId:ResponseNumからIndex:PluginName:FormId:ResponseNum:VoiceType:BsaName:FullPathに変更しました。列をソートしたときに、別の列がこの順序で二次ソートされるようになります。
- ダイアログボックス上のテキストボックスの操作改善。"X"ボタンで値をクリアできるようになった。

バグ修正:
- Plugins.txtに記載されないプラグインのロード順の修正。esmより前にespがロードされないようにした。TES4/FO3/FNVではplugins.txtを読み込んでいないので、この修正によるロード順への影響があります。基本的にはxEditと同様のロード順となるはずなので、これで問題ないと思います。
- その他細かな修正。

Version 1.3.3 (2017/11/23)
機能追加：
- AO_Comment列の追加。Fallout4でのみ有効。AO_Comment System (DIAL:KNAMレコード、コンパニオンに対して特定位置の状況を示すキーワードを提供する仕組み)のキーワードが表示される。この機能に関する情報提供とサポート提案をしてくださったThuggysmurf@NexusModsに感謝します！

変更:
- 既に再生中の音声と同一の音声を再生するとき、再生を停止するようにした。このアイデアを提供してくださったUbiSergei@NexusModsさんに感謝します！
- 音声再生の内部処理を大幅に変更しました。少し自信がないので、音声再生で何か問題があった場合は報告してください。

バグ修正:
- 右クリックメニューからファイル名/アセットパスをコピーするとき、スプレッドシートの逆順にソートされてコピーされるバグの修正。
- 部分フィルタ機能が意図通り動作しないバグを修正。これでState列が正しくフィルタリングされるはずです。
- 行の高さを変更したとき、スプレッドシートに即座に反映されないバグの修正。

Version 1.3.2 (2017/9/17)
機能追加：
- 表の右クリックメニューからオーディオファイルのエクスポートが可能に。選択された行のファイルをまとめてエクスポートできる。エクスポート先のフォルダは'<インストールフォルダ>/Export'固定。ファイルは常に上書きされる。エクスポート処理は'Pause'キーでキャンセル可能。大量にエクスポートする利用は想定外のため、Yakitori Audio Converterなどその他のツールを利用のこと。

バグ修正:
- 検索ボックス内のアイコンが表示されなくなるバグの修正
- 表のフィルタ：フィルタを開いたとき、前回の選択状態に関わらず部分フィルタがオンになるバグの修正
- 表のフィルタ：部分フィルタの動作不具合の修正
- .oggファイルから展開した.wavファイルの形式を32bit-PCMから16bit-PCMに変更した(TESフレンドリにした)

Version 1.3.1 (2017/7/14)
- ロシア語訳の改善。anizordaさんに感謝！
- 検索結果がちらつくバグの修正。
- ツールのウィンドウをアクティブにしたとき、検索テキストが全て選択されないバグの修正。

Version 1.3.0 (2017/7/12)
ロシア語訳の一部はまだgoogle翻訳です。校正が終わり次第アップデートされます。
機能追加:
- メニューとツールボタンで現在のファイルをリロードできるようにした
- ファイルメニューに最近使ったファイルの一覧を追加した

変更:
- 検索履歴をクリアできるようにした（検索履歴メニューの末尾にあり）
- メニュー/ステータスバーのボタンを使ってログウィンドウの表示を切り替えられるようにした
- 検索テキストボックスをクリックしたとき、テキストを全選択するようにした
- インストールされていないゲームのアイコンを少し変化させるようにした

バグ修正:
- インストールされていないゲームモードを選択しているとき、ファイルが絶対に開けないバグの修正

Version 1.3.0beta (2017/7/9)
このアップデートは主にUIと検索性の改善に焦点を当てたものです。
バグ回避・開発効率向上のために、.NETの前提バージョンを4.0から4.61に変更しました。.NET 4.61はWindows 7以降のPCで動作するはずなので大きな問題はないと思います。何か不都合があれば報告してください。

機能追加:
- UIの一新: 新ツールバー、モダンでリサイズ可能な検索ボックス、新しいツールボタン、新アイコンなど
- 検索機能の一新:
-- 新検索モード: AND検索/OR検索/前方一致/後方一致。正規表現に慣れていない方のために。内部では正規表現で検索されます。
-- リアルタイム検索: 検索処理は負荷が高く操作がスタックする可能性があるので、厳密にはリアルタイムではない。約1秒の間をおいて検索開始する。
-- 検索性能の向上
-- ワード単位オプション: "bye"で"Goodbye"をヒットしなくできる。中国語/日本語など、語を空白で区切らない言語では使い道がないかもしれない
-- 新しい検索履歴: 検索履歴に保存した検索対象/検索オプションを一緒に呼び出せる
- 新しい音声操作メニュー
-- 音声ファイルをコピー/音声ファイルをWAV形式でコピー/音声ファイルをクリップボード内名称でコピー
-- 複数選択に対応: 選択したテキストをコピー/選択行のファイル名をコピー/選択行のアセットパスをコピー
- 新しいState「マスターレコード参照」: マスタープラグインからのレコード情報参照を識別するためのもの
- 新オプション「音声パス内のプラグインをマスターとして読み込む」: プラグインがマスター定義することなく他プラグインの音声を置き換えることがあります。音声パス中のプラグインのレコードで対話を補完するにはこのオプションをチェックします
- Pauseキー/メニュー/ツールボタンで音声再生/検索を停止できるようにした

変更:
- 前提となる.NETのバージョンを4.0から4.61に変更した
- キーボードのメニューキーで音声操作メニューを表示できるようにした
- 音声操作メニュー表示時、表の選択状態を変更しないようにした。代わりに行の背景色で選択行をハイライトする
- 対話テキスト2の言語が指定されていない場合、Ctrl+Enterで検索対象を切り替えないようにした
- 行の高さオプションをツールバーからオプションメニューに移設した
- クリップボードにコピーされたテキストから検索するとき、テキストが音声ファイルの拡張子で終わっていればファイル名として検索するようにした

バグ修正:
- 音声ファイルを対話テキストでリネームする処理のバグ修正
- v1.2.4以降、ゲームモードメニューの数字とニモニックが表示されなくなっていたバグの修正
- その他ユーザーが気づかないだろういくつかのバグ修正
- ロシア語訳の訂正。anizordaさんに感謝！

Version 1.2.4 (2017/6/21)
このアップデートは主にmodの翻訳作業で気づいた小さな改善点とバグ修正に焦点を当てたものです。
機能追加:
- Category列をCategory/Subtypeに名称変更し、Dialogue Subtype(DIAL:SNAM)も一緒に表示するようにした。Power Attack/Blockといった値が表示され、台詞の状況が把握しやすくなるはず。TES4/FO3/FNVではSubtypeは表示されない。
- 設定ダイアログでゲームのインストールフォルダを明示的に設定できるようにした。ツールがゲームフォルダを認識しない場合や別のフォルダを使う場合に便利
- 編集/展開する音声ファイルを対話テキストでリネームするオプションを追加した。多くの音声ファイルを開いた際に識別しやすくなるはず。リネーム後のファイル名は最大100文字だが、ツールのインストールフォルダの深さによって短くなる場合がある点に注意のこと。

変更:
- Conditions列に表示可能な条件の追加
-- Race, InFaction
-- Player参照のみ: Sneaking, Running, InInterior, Raining, Snowing, Cloudy, Swimming, InCombat, RidingHorse, Sprinting, Blocking, Trespassing
- xWMAEncode.exeの実行にVisual C++ 2010のランタイムライブラリ(msvcp100.dllとmsvcr100.dll)が必要であることに気づいたので説明書に追記した（Skyrim Mod データベースのコメントに感謝）。サイドバイサイドに配置されたDLLがWindows Updateにより更新されることはなく、セキュリティ面の危険があるので、これらの重要なDLLをバンドルするつもりはない。Description/Readme上のリンクからダウンロードしてください。

バグ修正:
- Bsa Name列に"Loose"の代わりに間違ってフォルダ名が表示されることのあるバグの再修正
- Conditions列が正しくフィルタリングされないバグの修正。"PlayerGender: Male"でフィルタリングしたとき"not PlayerGender: Male"がヒットしないようになった。フィルタに関する他のバグ修正もいくつか行った
- 設定ダイアログで1行だけのBSA名ルールが正しく設定できないバグの修正
- インストールされていないゲームに対して空のオープンダイアログが表示されるバグの修正

Version 1.2.3 (2017/6/16)
バグ修正:
- Bsa Name列に"Loose"の代わりに間違ってフォルダ名が表示されることのあるバグの修正
- ゲームがインストールされていないプラグインをロードするとArgumentException例外となるバグの修正 (Thanks for bug report, bythetwinmoons!)
- Data/GameLang_SkyrimSE.txt内のタイポ修正

Version 1.2.2 (2017/6/7)
バグ修正:
- ロシア語訳の訂正

Version 1.2.1 (2017/6/6)
機能追加:
- ロシア語UIのサポート。翻訳者のanizordaさんに大きな感謝を！
- プラグイン種別によりゲームモードを自動選択するオプションの追加。ファイル-開くメニューまたはドラッグ＆ドロップで開くときにだけ有効。複数ファイルを開く場合は最初のプラグイン種別で切り替え。プラグイン種別が不明またはパッチの場合は切り替えない。

変更:
- ゲームがインストールされていなくても動作するようにした。この場合、プラグイン一覧からは開けない。ゲーム本体がないと全ての情報が表示されない点に注意。
Version 1.2.0 (2017/6/3)
機能追加:
- Oblivion/Fallout 3/Fallout New Vegasサポート
-- 旧形式のBSAファイル対応
-- mp3/oggファイルのサポート
- 列をウィンドウに収めるかどうかを選べるオプションの追加

変更:
- サポートするゲームの追加に伴いメニュー・設定ダイアログ・ショートカットキーを一新した
- State "Not Localized"の廃止（少しうざいので）。多言語対応かどうかはプラグインロード時のメッセージで確認できる
- ツールのファイル構成変更
-- 外部ライブラリのファイルをLibフォルダに集約した
-- ゲーム言語定義ファイルの名称・形式変更。ファイル名はData/GameLang_*.txtとなり、ゲーム毎に分割された
- Category, Emotion列にゲームに合った適切な値を表示するようにした
- プラグイン一覧ダイアログの「バニラ」ボタンの機能を明確化。バニラ+DLCを選択するようにした
- プラグインの読み込み時、プラグインの情報メッセージを表示するようにした
- Conditions列の表示形式の変更。GetIsIDの比較対象オブジェクトの種類に応じた適切な表示をする。否定条件判定に対応。
- 対話の表示言語をゲーム毎に定義することにした。

バグ修正:
- 音声ファイルがLIPしかないときの表示と操作が不正となるバグの修正
- 音声ファイル名にピリオドが含まれる場合、一部表示が不正となるバグの修正
- 設定ダイアログで、BSA名のデフォルトボタンが機能しないバグの修正
- Conditions列にカンマを含む値がある場合、部分フィルタが誤動作するバグの修正
- Conditions列に一部条件が正しく表示されないバグの修正。Conditionsの内容がより正確になった
- Conditions列の値に"[" "]"が含まれているとき、フィルタリングすると例外が発生するバグの修正
- "Ignore loose voice files in Data folder"オプションをチェックするとルーズなstringsファイルが読み込まれないバグの修正

Version 1.1.0 (2017/5/19)
機能追加:
- Fallout 4 サポート:
-- FO4のプラグイン形式のサポート。ただし、読み込める情報に制限があり、次の列は常に空白となります： Conditions
-- BA2形式のサポート。ただし、サポートするのは"GNRL"形式のBA2ファイルだけです（つまり、テクスチャのBA2ファイルは読み込めません）。
- 列の追加 : Script Notes, Edits, Prompt

変更:
- 言語定義ファイルの作り直し。TesLanguages.txtはGameLanguages.txtにリネームされ、形式が変更されました。
- クリップボード監視方式の改善。OpenOfficeと一緒に使うとクリップボードの動作がおかしくなる問題が解決しました。
- ベースゲームのBSA/BA2ファイル名の定義を変更しました。プラグインとBSA/BA2ファイルのマッピング規則の定義を追加しました。どちらもオプションダイアログで設定できます。

バグ修正:
- ステート"Overridden"の改善。ファイル名の重複により、ファイルの保存形態(BSA/BA2/loose)やファイル形式(fuz/xwm/wav)間での上書きが発生したとき、確実にこの状態となるようにしました。
- 音声ファイルの上書き処理の精度向上。バニラのエンジンに忠実に、lipを持たないxwmでfuzを上書きできないようにしました。
- ツールが空白を含むパスにインストールされているとき、音声編集が動作しないバグを修正しました。

Version 1.0.5 (2017/3/24)
機能追加:
- プラグインの言語を定義するData/TesLanguages.txtファイルを追加しました。このファイルに任意の言語とコードページを追加できます。ファイル内のコメントを参照してください。
- 一部の言語では、プラグインの言語をローカルコードページに変換しないとCreation Kitがクラッシュする可能性があるという問題があります。例えば日本語ではシフトJISコードページへの変換が必要です。このようなローカルコードページを持つプラグインを開きたい場合、Data/TesLanguages.txtファイルに定義を追加してください。

バグ修正:
- Topic Textがワードラップしないバグを修正しました。

Version 1.0.4 (2017/3/6)
機能追加:
- CSVのエクスポート機能を追加しました。現在表示されているレコードをCSVファイルにエクスポートできます。CSVエクスポートダイアログでお使いのスプレッドシートアプリに合ったオプションを選んでください。

Version 1.0.3 (2017/3/6)
機能追加:
- 列の追加 : Topic FormId, Topic Edid, Topic Text, Quest FormId, Quest Edid, Quest Name, Category, Emotion, Conditions

バグ修正:
- クリップボードからFormIdで検索するとき、先頭2文字が'a'～'f'のフォームIDがヒットしないバグを修正しました。

Version 1.0.2.1 (2017/3/5) : メンテナンスリリース
バグ修正:
- Form Idの一部が"03FFFFFF"というように正しく表示されないバグを修正しました。v1.0.2の修正が原因でした。申し訳ない！

Version 1.0.2 (2017/3/5)
変更:
- "State"列をアイコンで表示するようにしました。
- コードページ判定アルゴリズムの性能を少しだけ向上しました。
- xEdit/xTranslatorのように、FormIdの先頭にロード順を持たせることにしました（常に00で始まらない）。代わりにロード順を持たないFormId列 "FormId without Load#"を追加しました。用途に応じて両方を使い分けてください。
- クリップボードでFormIdを検索するとき、正規表現を使ってロードオーダーの違いを無視して検索します。他のツールのロードオーダーが同じとは限らないのでこうしました。

バグ修正:
- 長さ1文字のUTF8テキストが正しく表示されないバグの修正。UTF8を判定するアルゴリズムが間違っていました。
- オーバーライドされたマスターレコードのIndex値が間違っているバグを修正しました。

Version 1.0.1 (2017/3/3)
機能追加:
- クリップボードで検索 : クリップボードにコピーされたテキストで自動検索します。このオプションはオプションメニューで切り替えられます。xEdit や xTranslator と一緒に使う際に便利かもしれません。検索対象はテキストの形式によって次のように自動的に切り替わります。
-- Form Idで始まる場合 :Form Id
-- '[]' で囲まれたForm Idで始まる場合 : Form Id
-- '<>' で囲まれたEditor Idの場合 : Edid
-- その他の場合 : Dialogue 1 または Dialogue2 (最後に選んだもの)
- 検索履歴を最大10個まで保存。テキスト検索ボックスのドロップダウンで呼び出せます。

変更:
- テキスト検索ボックスはプラグインのロード時にクリアされます。
- 設定ダイアログのUI改善（アイコン、テキスト）
- ショートカットキーの追加: F5=開く, F7/F8=ゲームモード選択, Ctrl+1～Ctrl+5=検索対象の切り替え
- エラー処理改善
- テキスト検索ボックスのオートコンプリートの改善。検索対象列の検索対象列の実データに基づいてオートコンプリートされます。このオプションはオプションメニューで切り替えられます。ファイルLazyVoiceFinder_autocomp.iniは使われなくなりました。

Version 1.0.0 (2017/3/1):
- 初回リリース

//
